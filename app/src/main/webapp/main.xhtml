<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <title>Web Lab 3</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <h:outputStylesheet library="css" name="reset.css"/>
    <h:outputStylesheet library="css" name="styles.css"/>
    <h:outputStylesheet library="css" name="form.css"/>

    <h:outputScript library="js" name="ping.js" target="head"/>
    <h:outputScript library="js" name="app_state.js" target="head"/>
    <h:outputScript library="js" name="hidden_set.js" target="head"/>
    <h:outputScript library="js" name="ui_getters.js" target="head"/>
    <h:outputScript library="js" name="canvas.js" target="head"/>
    <h:outputScript library="js" name="main_init.js" target="head"/>

</h:head>

<h:body styleClass="body" id="mainbody">
    <header class="header">
        <div class="header-inner">
            <div id="student-name">Плотников Алексей Алексеевич</div>
            <div class="group">P3214</div>
            <div class="option">Вариант 9943</div>
        </div>
    </header>

    <div class="main-content">
        <div class="form-container">
            <h:form id="pointForm">
                <div class="form-body">

                    <div class="form-group">
                        <h:outputText value="X" styleClass="form-text"/>
                        <p:spinner styleClass="form-input"
                                   id="horizontalAfter" value="#{spinnerView.number}" buttons="horizontal-after"
                                   upButtonStyleClass="ui-button-success" downButtonStyleClass="ui-button-danger"
                                   min="-5" max="5" stepFactor="0.1" rotate="true" onkeydown="return false;"
                                   onchange="onClickSpinner(this)"
                        />
                    </div>

                    <div class="form-group">
                        <h:outputText value="Y" styleClass="form-text"/>
                        <h:inputText styleClass="form-input"
                                     id="textInput"
                                     value="#{textInputView.input}"
                        />
                    </div>

                    <div class="form-group">
                        <h:outputText value="R" styleClass="form-text"/>
                        <h:panelGroup id="checkboxes">
                            <ui:repeat var="option" value="#{checkboxView.options}">
                                <h:selectBooleanCheckbox
                                        value="#{checkboxView.selectedOptions[option]}"
                                        styleClass="r-select-checkbox">
                                    <f:ajax event="change" render="@this" onevent="handlePointAjax"/>
                                </h:selectBooleanCheckbox>
                                #{option}<br/>
                            </ui:repeat>
                        </h:panelGroup>
                    </div>

                    <p:commandButton styleClass="form-submit" value="Submit" type="button" onclick="submitForm()"/>
                </div>
            </h:form>
        </div>


        <div class="image-container" style="text-align: center">
            <canvas id="coordinate-plane">
            </canvas>
        </div>

        <div class="table-container">
            <p:dataTable value="#{controllerBean.getPointsReversed()}" var="dot" styleClass="table" id="table"
                         scrollable="true" scrollHeight="700">
                <p:column headerText="X">
                    <h:outputText value="#{dot.x}"/>
                </p:column>

                <p:column headerText="Y">
                    <h:outputText value="#{dot.y}"/>
                </p:column>

                <p:column headerText="R">
                    <h:outputText value="#{dot.r}"/>
                </p:column>

                <p:column headerText="Попадание">
                    <h:outputText value="#{dot.check}"/>
                </p:column>

                <p:column headerText="Текущее время">
                    <h:outputText value="#{dot.beautifulDate()}"/>
                </p:column>

                <p:column headerText="Время выполнения">
                    <h:outputText value="#{dot.beautifulDuration()}"/>
                </p:column>
            </p:dataTable>

            <h:form id="clearForm">
                <p:commandButton value="Clear" action="#{controllerBean.clear}"
                                 update=":table"
                                 oncomplete="handlePointOnComplete()"/>
            </h:form>

            <p:button value="На главную"  outcome="clock" />

        </div>
    </div>

    <h:form id="hiddenForm">
        <h:inputHidden id="x" value="#{point.x}"/>
        <h:inputHidden id="y" value="#{point.y}"/>
        <h:inputHidden id="r" value="#{point.r}"/>

        <p:commandButton id="saveButton" value="Save Point" action="#{point.submit(false)}" styleClass="hidden-button"
                         update=":table :pointForm"
                         oncomplete="handlePointOnComplete(); reapplyValidation();"/>

        <p:commandButton id="saveButtonHidden" value="Save Point Hidden" action="#{point.submit(true)}"
                         styleClass="hidden-button"
                         update=":table"
                         oncomplete="handlePointOnComplete();"/>
    </h:form>

    <p:dialog id="serverDownDialog"
              widgetVar="serverDownDialog"
              modal="true"
              closable="false"
              draggable="false"
              resizable="false"
              visible="false"
              showHeader="false"
              style="text-align:center;">

        <h:panelGroup style="padding:20px; display:block;">
            <h:outputText value="Сервер недоступен. Ждём восстановление..."
                          style="font-size:20px; display:block; margin-bottom:10px;"/>
            <i class="pi pi-spin pi-spinner" style="font-size:2rem; margin-top:10px;"></i>
        </h:panelGroup>

    </p:dialog>

    <p:dialog id="serverBackDialog"
              widgetVar="serverBackDialog"
              modal="true"
              closable="false"
              draggable="false"
              resizable="false"
              visible="false">
        <h:panelGroup>
            <h:outputText value="Сервер снова доступен. Перезагрузить страницу?"/>
            <br/><br/>
            <p:commandButton value="Перезагрузить"
                             onclick="location.reload()"
                             styleClass="ui-button-success"/>
        </h:panelGroup>
    </p:dialog>
</h:body>
</html>
